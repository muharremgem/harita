<!DOCTYPE html>
<html lang="tr">

<head>
       <meta charset="UTF-8">
       <meta name="viewport" content="width=device-width, initial-scale=1.0">
       <title>Eczane Arama</title>
       <style>
              :root {
                     --primary-color: #06AFF2;
                     --secondary-color: #f6f6f6;
                     --text-color: #333;
                     --border-color: #ddd;
              }

              * {
                     margin: 0;
                     padding: 0;
                     box-sizing: border-box;
                     font-family: 'Arial', sans-serif;
              }

              body {
                     color: var(--text-color);
                     background-color: #fff;
                     line-height: 1.6;
              }

              .container {
                     max-width: 1200px;
                     margin: 0 auto;
                     padding: 20px;
              }

              .page-title {
                     text-align: center;
                     margin-bottom: 30px;
                     color: var(--primary-color);
              }

              .map-container {
                     margin-bottom: 40px;
                     text-align: center;
              }

              .map-image {
                     max-width: 100%;
                     height: auto;
                     border-radius: 8px;
                     box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
              }

              .search-container {
                     background-color: var(--secondary-color);
                     padding: 30px;
                     border-radius: 8px;
                     margin-bottom: 40px;
                     box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
              }

              .search-title {
                     text-align: center;
                     margin-bottom: 20px;
                     font-size: 1.5rem;
                     color: var(--primary-color);
              }

              .search-form {
                     display: flex;
                     flex-wrap: wrap;
                     gap: 20px;
                     justify-content: center;
                     align-items: flex-end;
              }

              .form-group {
                     flex: 1 1 200px;
              }

              .form-group label {
                     display: block;
                     margin-bottom: 8px;
                     font-weight: bold;
              }

              .form-group select,
              .form-group input {
                     width: 100%;
                     padding: 12px;
                     border: 1px solid var(--border-color);
                     border-radius: 4px;
                     background-color: #fff;
                     font-size: 16px;
              }

              .search-button {
                     padding: 12px 30px;
                     background-color: var(--primary-color);
                     color: white;
                     border: none;
                     border-radius: 4px;
                     cursor: pointer;
                     font-size: 16px;
                     font-weight: bold;
                     transition: background-color 0.3s;
                     flex: 0 0 auto;
              }

              .search-button:hover {
                     background-color: #06AFF2;
              }

              .results-container {
                     margin-top: 40px;
              }

              .no-results {
                     text-align: center;
                     padding: 20px;
                     font-style: italic;
                     color: #666;
                     display: none;
              }

              .pharmacy-list {
                     display: grid;
                     grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
                     gap: 20px;
              }

              .pharmacy-card {
                     border: 1px solid var(--border-color);
                     border-radius: 8px;
                     padding: 20px;
                     background-color: white;
                     box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
                     transition: transform 0.3s, box-shadow 0.3s;
              }

              .pharmacy-card:hover {
                     transform: translateY(-3px);
                     box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
              }

              .pharmacy-name {
                     color: var(--primary-color);
                     font-size: 1.2rem;
                     margin-bottom: 10px;
                     border-bottom: 1px solid var(--border-color);
                     padding-bottom: 10px;
              }

              .pharmacy-address,
              .pharmacy-location,
              .pharmacy-phone {
                     margin-bottom: 8px;
              }

              .load-more {
                     display: block;
                     margin: 30px auto 0;
                     padding: 10px 25px;
                     background-color: var(--secondary-color);
                     color: var(--primary-color);
                     border: 1px solid var(--primary-color);
                     border-radius: 4px;
                     cursor: pointer;
                     font-size: 16px;
                     transition: all 0.3s;
                     text-align: center;
                     max-width: 200px;
              }

              .load-more:hover {
                     background-color: var(--primary-color);
                     color: white;
              }

              .hidden {
                     display: none;
              }

              /* Responsive tasarÄ±m */
              @media (max-width: 768px) {
                     .search-form {
                            flex-direction: column;
                            align-items: stretch;
                     }

                     .form-group {
                            flex: 1 1 100%;
                     }

                     .pharmacy-list {
                            grid-template-columns: 1fr;
                     }
              }
       </style>
</head>

<body>
       <div class="container">
              <h1 class="page-title">Kiperin Eczanelerimiz</h1>

              <div class="map-container">
                     <img src="https://cdn.shopify.com/s/files/1/0586/1910/1363/files/Eczanelerimiz.jpg?v=1746695680"
                            alt="TÃ¼rkiye HaritasÄ±" class="map-image" style="width: 100%; height: auto;">
              </div>

              <div class="search-container">
                     <h2 class="search-title" style="text-transform: capitalize;">Sizlere En YakÄ±n Eczaneyi BulalÄ±m ðŸ¤—
                     </h2>

                     <div class="search-form">
                            <div class="form-group">
                                   <label for="city">Ä°l</label>
                                   <select id="city">
                                          <option value="">SeÃ§iniz</option>
                                   </select>
                            </div>
                            <div class="form-group">
                                   <label for="district">Ä°lÃ§e</label>
                                   <select id="district">
                                          <option value="">SeÃ§iniz</option>
                                   </select>
                            </div>
                            <button type="button" class="search-button" id="searchButton">ARA</button>
                     </div>
              </div>

              <div class="results-container">
                     <div class="no-results" id="noResults">Arama kriterlerinize uygun eczane bulunamadÄ±.</div>
                     <div class="pharmacy-list" id="pharmacyList"></div>
                     <button type="button" class="load-more hidden" id="loadMoreButton">Daha Fazla</button>
              </div>
       </div>

       <script>
              document.addEventListener('DOMContentLoaded', function ()
              {
                     // Sabitler
                     const ITEMS_PER_PAGE = 6;

                     // DOM Elementleri
                     const citySelect = document.getElementById('city');
                     const districtSelect = document.getElementById('district');
                     const searchButton = document.getElementById('searchButton');
                     const pharmacyList = document.getElementById('pharmacyList');
                     const noResults = document.getElementById('noResults');
                     const loadMoreButton = document.getElementById('loadMoreButton');

                     // Uygulama Verisi
                     let allPharmacies = [];
                     let filteredPharmacies = [];
                     let currentPage = 1;
                     let cities = {};

                     // Statik il listesi - CSV hatasÄ± durumunda kullanÄ±lacak
                     const TurkiyeIlleri = [
                            "ADANA", "ADIYAMAN", "AFYONKARAHÄ°SAR", "AÄžRI", "AMASYA", "ANKARA", "ANTALYA", "ARTVÄ°N", "AYDIN", "BALIKESÄ°R",
                            "BÄ°LECÄ°K", "BÄ°NGÃ–L", "BÄ°TLÄ°S", "BOLU", "BURDUR", "BURSA", "Ã‡ANAKKALE", "Ã‡ANKIRI", "Ã‡ORUM", "DENÄ°ZLÄ°",
                            "DÄ°YARBAKIR", "EDÄ°RNE", "ELAZIÄž", "ERZÄ°NCAN", "ERZURUM", "ESKÄ°ÅžEHÄ°R", "GAZÄ°ANTEP", "GÄ°RESUN", "GÃœMÃœÅžHANE", "HAKKARÄ°",
                            "HATAY", "ISPARTA", "MERSÄ°N", "Ä°STANBUL", "Ä°ZMÄ°R", "KARS", "KASTAMONU", "KAYSERÄ°", "KIRKLARELÄ°", "KIRÅžEHÄ°R",
                            "KOCAELÄ°", "KONYA", "KÃœTAHYA", "MALATYA", "MANÄ°SA", "KAHRAMANMARAÅž", "MARDÄ°N", "MUÄžLA", "MUÅž", "NEVÅžEHÄ°R",
                            "NÄ°ÄžDE", "ORDU", "RÄ°ZE", "SAKARYA", "SAMSUN", "SÄ°Ä°RT", "SÄ°NOP", "SÄ°VAS", "TEKÄ°RDAÄž", "TOKAT", "TRABZON",
                            "TUNCELÄ°", "ÅžANLIURFA", "UÅžAK", "VAN", "YOZGAT", "ZONGULDAK", "AKSARAY", "BAYBURT", "KARAMAN", "KIRIKKALE",
                            "BATMAN", "ÅžIRNAK", "BARTIN", "ARDAHAN", "IÄžDIR", "YALOVA", "KARABÃœK", "KÄ°LÄ°S", "OSMANÄ°YE", "DÃœZCE"
                     ];

                     // SÄ±k kullanÄ±lan ilÃ§eler - CSV'de ilÃ§e bilgisi eksikse kullanÄ±lacak
                     const YayginIlceler = ["MERKEZ", "BAÄžCILAR", "BAKIRKÃ–Y", "BEÅžÄ°KTAÅž", "KADIKÃ–Y", "KARTAL", "MALTEPE", "PENDÄ°K", "ÅžÄ°ÅžLÄ°", "ÃœSKÃœDAR"];

                     // TÃœM Ä°LLERÄ° MANUEL OLARAK EKLE
                     function setupCitySelect()
                     {
                            // Ã–nce statik il listesini ekle
                            citySelect.innerHTML = '<option value="">SeÃ§iniz</option>';

                            TurkiyeIlleri.forEach(city =>
                            {
                                   const option = document.createElement('option');
                                   option.value = city;
                                   option.textContent = city;
                                   citySelect.appendChild(option);

                                   // Ä°l iÃ§in boÅŸ bir ilÃ§e seti oluÅŸtur
                                   if (!cities[city])
                                   {
                                          cities[city] = new Set();
                                   }
                            });

                            // CSV yÃ¼klendiÄŸinde bu illere ilÃ§eler eklenecek
                     }

                     // SayfayÄ± baÅŸlat - Ã–nce statik olarak illeri yÃ¼kle, ardÄ±ndan CSV'den veri Ã§ek
                     setupCitySelect();

                     // Daha sonra CSV verilerini yÃ¼kle
                     fetchPharmacyData();

                     // Olay dinleyicileri
                     citySelect.addEventListener('change', updateDistricts);
                     searchButton.addEventListener('click', searchPharmacies);
                     loadMoreButton.addEventListener('click', loadMorePharmacies);

                     // Eczane verilerini CSV'den yÃ¼kle
                     function fetchPharmacyData()
                     {
                            // DoÄŸru GitHub raw URL formatÄ±
                            const csvUrl = 'https://raw.githubusercontent.com/muharremgem/harita/main/kiperin-collagen-turkiye.myshopify.com-store.csv';

                            // CORS hatalarÄ±nÄ± Ã¶nlemek iÃ§in proxy kullanma seÃ§eneÄŸi
                            const corsProxyUrl = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(csvUrl);

                            // Ã–nce direkt URL'i dene, hata alÄ±rsa proxy kullan lÃ¼tfen asd6546


                            fetch(csvUrl)
                                   .then(response =>
                                   {
                                          if (!response.ok)
                                          {
                                                 throw new Error("CSV dosyasÄ± direkt yÃ¼klenemedi, proxy deneniyor");
                                          }
                                          return response.text();
                                   })
                                   .catch(error =>
                                   {
                                          console.warn("Direkt eriÅŸimde hata, proxy deneniyor:", error);
                                          // CORS hatasÄ± varsa proxy URL ile tekrar dene
                                          return fetch(corsProxyUrl)
                                                 .then(response =>
                                                 {
                                                        if (!response.ok)
                                                        {
                                                               throw new Error("Proxy ile de CSV dosyasÄ± yÃ¼klenemedi");
                                                        }
                                                        return response.text();
                                                 });
                                   })
                                   .then(data =>
                                   {
                                          try
                                          {
                                                 parseCSV(data);
                                                 console.log("CSV verisi baÅŸarÄ±yla yÃ¼klendi");
                                          } catch (error)
                                          {
                                                 console.error("CSV ayrÄ±ÅŸtÄ±rma hatasÄ±:", error);
                                                 // Hata durumunda Ã¶rnek veriler oluÅŸtur
                                                 createSampleData();
                                          }
                                   })
                                   .catch(error =>
                                   {
                                          console.error('Veri yÃ¼klenirken hata oluÅŸtu:', error);
                                          // Dosya bulunamadÄ±ysa Ã¶rnek veri oluÅŸtur
                                          createSampleData();
                                   });
                     }

                     // Ã–rnek veri oluÅŸtur (CSV yÃ¼klenemediÄŸinde)
                     function createSampleData()
                     {
                            console.log("Ã–rnek veri oluÅŸturuluyor...");
                            allPharmacies = [];

                            // Her il iÃ§in en az bir eczane ve ilÃ§e ekle
                            TurkiyeIlleri.forEach(il =>
                            {
                                   // Her il iÃ§in bir merkez ilÃ§esi olsun
                                   cities[il].add("MERKEZ");

                                   // BazÄ± iller iÃ§in ek ilÃ§eler
                                   if (["Ä°STANBUL", "ANKARA", "Ä°ZMÄ°R", "BURSA", "ANTALYA"].includes(il))
                                   {
                                          YayginIlceler.forEach(ilce =>
                                          {
                                                 cities[il].add(ilce);
                                          });
                                   }

                                   // Her il iÃ§in en az bir eczane
                                   allPharmacies.push({
                                          name: `${il} Merkez Eczanesi`,
                                          address: `${il} MERKEZ`,
                                          city: il,
                                          district: "MERKEZ",
                                          phone: "0555 555 5555"
                                   });

                                   // BÃ¼yÃ¼k iller iÃ§in ek eczaneler
                                   if (["Ä°STANBUL", "ANKARA", "Ä°ZMÄ°R"].includes(il))
                                   {
                                          for (let i = 1; i <= 5; i++)
                                          {
                                                 const district = YayginIlceler[i % YayginIlceler.length];
                                                 allPharmacies.push({
                                                        name: `${il} ${district} Eczanesi ${i}`,
                                                        address: `${district} Mahallesi, ${il}`,
                                                        city: il,
                                                        district: district,
                                                        phone: `0555 555 ${1000 + i}`
                                                 });
                                          }
                                   }
                            });

                            console.log(`${allPharmacies.length} Ã¶rnek eczane oluÅŸturuldu`);
                     }

                     // CSV verilerini ayrÄ±ÅŸtÄ±r
                     function parseCSV(csv)
                     {
                            const lines = csv.split('\n');

                            // BaÅŸlÄ±klarÄ± al
                            const headerLine = lines[0].replace(/\r/g, '');
                            const headers = headerLine.split(',');

                            // SÃ¼tun indekslerini bul
                            const nameIndex = findIndex(headers, "Location_name");
                            const addressIndex = findIndex(headers, "Address");
                            const cityIndex = findIndex(headers, "City");
                            const phoneIndex = findIndex(headers, "Phone");

                            console.log("SÃ¼tun indeksleri:", { nameIndex, addressIndex, cityIndex, phoneIndex });

                            if (nameIndex === -1 || cityIndex === -1)
                            {
                                   throw new Error("Gerekli sÃ¼tunlar bulunamadÄ±");
                            }

                            // CSV satÄ±rlarÄ±nÄ± iÅŸle
                            for (let i = 1; i < lines.length; i++)
                            {
                                   const line = lines[i].replace(/\r/g, '');
                                   if (!line.trim()) continue;

                                   try
                                   {
                                          // Basit CSV ayrÄ±ÅŸtÄ±rma
                                          const values = parseCSVLine(line);

                                          if (!values || values.length <= Math.max(nameIndex, cityIndex)) continue;

                                          const name = cleanValue(values[nameIndex]);
                                          const address = addressIndex !== -1 ? cleanValue(values[addressIndex]) : "";
                                          const city = cleanValue(values[cityIndex]);
                                          const phone = phoneIndex !== -1 ? cleanValue(values[phoneIndex]) : "";

                                          if (name && city)
                                          {
                                                 // Adres yoksa district = city olur
                                                 const district = address || city;

                                                 // Ä°l ve ilÃ§e bilgisini gÃ¼ncelle
                                                 if (!cities[city])
                                                 {
                                                        cities[city] = new Set();
                                                 }

                                                 if (district)
                                                 {
                                                        cities[city].add(district);
                                                 }

                                                 // Eczane ekle
                                                 allPharmacies.push({
                                                        name,
                                                        address,
                                                        city,
                                                        district,
                                                        phone
                                                 });
                                          }
                                   } catch (e)
                                   {
                                          console.warn(`SatÄ±r ${i} ayrÄ±ÅŸtÄ±rÄ±lamadÄ±:`, e);
                                   }
                            }

                            console.log(`${allPharmacies.length} eczane yÃ¼klendi`);
                     }

                     // DeÄŸeri temizle
                     function cleanValue(value)
                     {
                            if (!value) return "";
                            return value.replace(/^["']|["']$/g, '').trim();
                     }

                     // BaÅŸlÄ±kta indeks bul
                     function findIndex(headers, name)
                     {
                            for (let i = 0; i < headers.length; i++)
                            {
                                   const header = headers[i].replace(/^["']|["']$/g, '').trim();
                                   if (header.toLowerCase() === name.toLowerCase())
                                   {
                                          return i;
                                   }
                            }
                            return -1;
                     }

                     // Basit CSV satÄ±r ayrÄ±ÅŸtÄ±rma
                     function parseCSVLine(line)
                     {
                            const values = [];
                            let current = "";
                            let inQuotes = false;

                            for (let i = 0; i < line.length; i++)
                            {
                                   const char = line[i];

                                   if (char === '"')
                                   {
                                          inQuotes = !inQuotes;
                                   } else if (char === ',' && !inQuotes)
                                   {
                                          values.push(current);
                                          current = "";
                                   } else
                                   {
                                          current += char;
                                   }
                            }

                            // Son deÄŸeri ekle
                            values.push(current);
                            return values;
                     }

                     // Ä°lÃ§e seÃ§imini gÃ¼ncelle
                     function updateDistricts()
                     {
                            // Ä°lÃ§e seÃ§imini temizle
                            districtSelect.innerHTML = '<option value="">SeÃ§iniz</option>';

                            const selectedCity = citySelect.value;
                            if (!selectedCity) return;

                            if (cities[selectedCity])
                            {
                                   // Ä°lÃ§eleri sÄ±rala
                                   const districts = Array.from(cities[selectedCity]).sort();

                                   // Ä°lÃ§e seÃ§imini oluÅŸtur
                                   districts.forEach(district =>
                                   {
                                          const option = document.createElement('option');
                                          option.value = district;
                                          option.textContent = district;
                                          districtSelect.appendChild(option);
                                   });

                                   console.log(`${selectedCity} iÃ§in ${districts.length} ilÃ§e yÃ¼klendi`);
                            } else
                            {
                                   console.warn(`${selectedCity} iÃ§in ilÃ§e bulunamadÄ±`);
                            }
                     }

                     // Eczane ara
                     function searchPharmacies()
                     {
                            const selectedCity = citySelect.value;
                            const selectedDistrict = districtSelect.value;

                            if (!selectedCity)
                            {
                                   alert('LÃ¼tfen bir il seÃ§in');
                                   return;
                            }

                            console.log(`Arama: ${selectedCity} - ${selectedDistrict || "TÃ¼m Ä°lÃ§eler"}`);

                            // Filtreleme iÅŸlemi
                            filteredPharmacies = allPharmacies.filter(pharmacy =>
                            {
                                   // Åžehir kontrolÃ¼
                                   if (pharmacy.city !== selectedCity) return false;

                                   // Ä°lÃ§e seÃ§ilmiÅŸse kontrolÃ¼ yap
                                   if (selectedDistrict && pharmacy.district !== selectedDistrict) return false;

                                   return true;
                            });

                            // Eczaneleri alfabetik olarak sÄ±rala
                            filteredPharmacies.sort((a, b) => a.name.localeCompare(b.name, 'tr'));

                            console.log(`${filteredPharmacies.length} eczane bulundu`);

                            // Arama sonuÃ§larÄ±nÄ± gÃ¶ster
                            currentPage = 1;
                            displayResults();
                     }

                     // SonuÃ§larÄ± gÃ¶ster
                     function displayResults()
                     {
                            // Liste temizleme
                            pharmacyList.innerHTML = '';

                            if (filteredPharmacies.length === 0)
                            {
                                   noResults.style.display = 'block';
                                   loadMoreButton.classList.add('hidden');
                                   return;
                            }

                            noResults.style.display = 'none';

                            // EÄŸer currentPage -1 ise, tÃ¼m eczaneleri gÃ¶ster
                            // Aksi takdirde sadece ilk sayfadaki eczaneleri gÃ¶ster
                            const startIndex = 0;
                            const endIndex = (currentPage === -1)
                                   ? filteredPharmacies.length // TÃ¼m eczaneler
                                   : Math.min(ITEMS_PER_PAGE, filteredPharmacies.length); // Ä°lk 6 eczane

                            // Eczane kartlarÄ±nÄ± oluÅŸtur
                            for (let i = startIndex; i < endIndex; i++)
                            {
                                   const pharmacy = filteredPharmacies[i];
                                   const card = createPharmacyCard(pharmacy);
                                   pharmacyList.appendChild(card);
                            }

                            // Daha fazla dÃ¼ÄŸmesini gÃ¶ster/gizle
                            if (currentPage === -1 || endIndex >= filteredPharmacies.length)
                            {
                                   loadMoreButton.classList.add('hidden');
                            } else if (filteredPharmacies.length > ITEMS_PER_PAGE)
                            {
                                   loadMoreButton.classList.remove('hidden');
                            } else
                            {
                                   loadMoreButton.classList.add('hidden');
                            }
                     }

                     // Eczane kartÄ± oluÅŸtur
                     function createPharmacyCard(pharmacy)
                     {
                            const card = document.createElement('div');
                            card.className = 'pharmacy-card';

                            const name = document.createElement('h3');
                            name.className = 'pharmacy-name';
                            name.textContent = pharmacy.name;
                            card.appendChild(name);

                            if (pharmacy.address)
                            {
                                   const address = document.createElement('p');
                                   address.className = 'pharmacy-address';
                                   address.textContent = pharmacy.address;
                                   card.appendChild(address);
                            }

                            const location = document.createElement('p');
                            location.className = 'pharmacy-location';
                            location.textContent = pharmacy.city + (pharmacy.district !== pharmacy.city ? ` - ${pharmacy.district}` : '');
                            card.appendChild(location);

                            if (pharmacy.phone)
                            {
                                   const phone = document.createElement('p');
                                   phone.className = 'pharmacy-phone';
                                   phone.textContent = pharmacy.phone;
                                   card.appendChild(phone);
                            }

                            return card;
                     }

                     // Daha fazla eczane yÃ¼kle
                     function loadMorePharmacies()
                     {
                            // TÃ¼m kalan eczaneleri gÃ¶ster
                            currentPage = -1; // Ã–zel deÄŸer: tÃ¼mÃ¼nÃ¼ gÃ¶ster
                            displayResults();
                     }
              });
       </script>
</body>

</html>